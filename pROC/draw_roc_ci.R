library(pROC)
library(egg) # drwa beautiful images
#library(RColorBrewer) #colorbar

y1 <- c(0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1,
   1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0,
   1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0,
   1, 0, 1, 1, 0, 0, 0, 0, 0)
sgd <- c(0.72312367,  0.39980977, -0.70097657,  1.01631139, -1.6508767 ,
                  0.22766929, -0.87385105, -1.42789829, -0.50978383, -2.07784508,
                  1.7860608 ,  0.66615838, -1.89814115,  0.71511343, -0.75554835,
                  -1.34268972, -0.8452248 , -1.22071699, -1.99413643, -0.50116724,
                  -1.25784696,  0.02785996,  1.03386372, -0.04932988,  2.39464792,
                  -0.35010662, -1.48451378,  0.38752314,  0.85253221, -0.25019795,
                  1.61050879,  1.26859713, -1.49846388,  0.92760207,  1.44594676,
                  -1.23269654, -1.55030729,  0.02397522,  0.80580694, -0.94629467,
                  -0.43557335, -1.02550174, -0.7015419 , -1.4032276 ,  1.43682554,
                  0.3152954 ,  0.0334765 ,  0.24907712, -1.51670632, -0.59102003,
                  -1.54509993,  0.68436951,  0.08870872, -1.29385309,  0.36073329,
                  -0.98084116,  2.67070193,  0.82453423, -1.83546116,  0.40051707,
                  -1.25106773,  2.85025618,  1.30083977,  1.48096699,  0.39160998,
                  -1.76196663,  2.74453605, -1.06991411,  0.11569793,  0.26265912,
                  -1.52903099, -1.68799994, -0.59308524, -0.28614713, -0.93526019)
rf <- c(0.51851852, 1.        , 0.18518519, 0.85185185, 0.        ,
                  0.66666667, 0.18518519, 0.14814815, 0.33333333, 0.        ,
                  1.        , 1.        , 0.        , 1.        , 0.33333333,
                  0.        , 0.33333333, 0.        , 0.        , 0.33333333,
                  0.        , 0.81481481, 1.        , 0.33333333, 1.        ,
                  0.15555556, 0.06060606, 0.66666667, 1.        , 0.26666667,
                  0.91111111, 0.85555556, 0.11111111, 0.85555556, 0.76666667,
                  0.11111111, 0.06060606, 0.82222222, 0.85555556, 0.15555556,
                  0.15555556, 0.        , 0.26666667, 0.21616162, 0.85555556,
                  0.91111111, 0.43333333, 0.66666667, 0.06060606, 0.1754902 ,
                  0.        , 0.58888889, 0.73333333, 0.        , 0.63809524,
                  0.16666667, 0.66296296, 0.9462963 , 0.        , 0.65      ,
                  0.        , 0.8510582 , 0.9462963 , 0.8510582 , 0.8510582 ,
                  0.09215686, 0.8510582 , 0.09215686, 0.65      , 0.9462963 ,
                  0.09215686, 0.        , 0.2254902 , 0.46296296, 0.        )
svm <- c(0.73192432, 0.76413036, 0.34075397, 0.8213859 , 0.04307162,
                  0.48468324, 0.17474068, 0.11217057, 0.35308007, 0.0253678 ,
                  0.97074273, 0.84904803, 0.04047694, 0.84985575, 0.20906655,
                  0.09035234, 0.19388436, 0.09649599, 0.02994892, 0.34957773,
                  0.14341135, 0.607255  , 0.89448447, 0.56872131, 0.98448264,
                  0.42505149, 0.0838077 , 0.69557985, 0.88925073, 0.43041704,
                  0.94281477, 0.93168635, 0.17524325, 0.87484605, 0.91246575,
                  0.16216062, 0.07890475, 0.54335175, 0.89917583, 0.20682048,
                  0.3352367 , 0.15934692, 0.26901561, 0.10937705, 0.92240921,
                  0.74401725, 0.54629877, 0.59341492, 0.08076453, 0.2492641 ,
                  0.04833389, 0.76624209, 0.41523756, 0.07273415, 0.56412295,
                  0.10386977, 0.98327389, 0.8381593 , 0.02823063, 0.67510847,
                  0.07836242, 0.99515639, 0.89120713, 0.94804383, 0.81173022,
                  0.03044441, 0.98583329, 0.09231941, 0.44880951, 0.6787739 ,
                  0.07401733, 0.04691326, 0.25888165, 0.47388505, 0.11976995)

y_score1 <- data.frame(y=y1, SGD=sgd, RF=rf, SVM=svm)
roc_sgd = roc(y_score1$y, y_score1$SGD,  ci=T, auc=T)
roc_rf = roc(y_score1$y, y_score1$RF,  ci=T, auc=T)
roc_svm = roc(y_score1$y, y_score1$SVM,  ci=T, auc=T)

#DeLong's test for two correlated ROC curves
roc.test(roc_sgd, roc_rf) #Z = -0.78494, p-value = 0.4325
roc.test(roc_sgd, roc_svm)#Z = 0.42282, p-value = 0.6724
roc.test(roc_svm, roc_rf) #Z = -1.1988, p-value = 0.2306, NS

print(roc_sgd$ci) #95% CI: 0.8609371 0.9268293 0.9927214 (DeLong)
print(roc_rf$ci) #0.8724643 0.9390244 1.0000000
print(roc_svm$ci) #0.8552955 0.9225251 0.9897547



draw_roc_ci <- function(y_score){
  roc.list <- roc(y ~ sgd + rf + svm, data=y_score, ci=T, auc = T, print.auc=TRUE)
  
  ci.list <- lapply(roc.list, ci.se, specificities = seq(0, 1, l = 25), boot.n=2000) #Calculate 25 CI in specificities 0~1
  
  dat.ci.list <- lapply(ci.list, function(ciobj){ 
    data.frame(x = as.numeric(rownames(ciobj)),
               lower = ciobj[, 1],
               upper = ciobj[, 3])
      }
    )
  #theme_article()
  p <- ggroc(roc.list, lwd=1) + theme_classic() + 
    theme(text=element_text(size=17))+ 
    geom_abline(slope=1, intercept = 1, linetype = "dashed", alpha=0.7, color = "grey", lwd=1)+
    #theme(panel.background = element_rect(color='black'))+      #frame
    labs(x='Specificity(%)',y='Sensitivity(%)')+ 
    coord_fixed(ratio = 1, xlim =c(1,0), ylim =c(0,1), expand = F) #expand=F, No additional segment added to the axis
  
  for(i in 1:3) {
    p <- p + geom_ribbon(
      data = dat.ci.list[[i]],
      aes(x = x, ymin = lower, ymax = upper),
      fill = i + 1,
      alpha = 0.1,
      inherit.aes = FALSE)
  }
  p
}
draw_roc_ci(y_score1)
ggsave('ROC_3attr.svg', path='E:\\test')